<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.manage.sys.sms.dao.IApplyMapper">

    <sql id="table_name">TD_APPLY</sql>
    <sql id="table_user">TM_USER</sql>
    <sql id="table_stall">TD_STALL</sql>
    <sql id="base_columns">
        id,user_id,username,stall_id,stall_name,bazaar_id,bazaar_name,message,status,handler_time,create_time
    </sql>
    <sql id="base_columns_without_id">
        user_id,username,stall_id,stall_name,bazaar_id,bazaar_name,message,status,handler_time,create_time
    </sql>


    <resultMap id="apply_result_map" type="com.manage.sys.sms.api.entity.ApplyEntity">
        <id property="id" column="id"/>
        <result property="userId" column="user_id"/>
        <result property="username" column="username"/>
        <result property="stallId" column="stall_id"/>
        <result property="stallName" column="stall_name"/>
        <result property="bazaarId" column="bazaar_id"/>
        <result property="bazaarName" column="bazaar_name"/>
        <result property="message" column="message"/>
        <result property="status" column="status"/>
        <result property="handlerTime" column="handler_time"/>
        <result property="createTime" column="create_time"/>
    </resultMap>

    <insert id="insert" parameterType="com.manage.sys.sms.api.entity.ApplyEntity">
        INSERT INTO
        <include refid="table_name"/>
        (
        <include refid="base_columns_without_id"/>
        )
        VALUES
        (
         #{userId},
         #{username},
         #{stallId},
         #{stallName},
         #{bazaarId},
         #{bazaarName},
         #{message},
         #{status},
         #{handlerTime},
         now()
        )
    </insert>

    <update id="update">
        UPDATE
        <include refid="table_name"/>
        SET
        message = #{message},
        status = #{status},
        handler_time = now()
        WHERE id = #{id}

    </update>

    <delete id="delete" parameterType="java.util.Set">
        DELETE FROM
        <include refid="table_name"/>
        <where>
            id IN
            <foreach collection="ids" item="id" open="(" close=")" separator=",">
                #{id}
            </foreach>
        </where>
    </delete>

    <select id="getByUserIdAndStallId" resultMap="apply_result_map">
        SELECT
        <include refid="base_columns"/>
        FROM
        <include refid="table_name"/>
        WHERE user_id = #{userId} AND stall_id = #{stallId}
    </select>

    <select id="getById" parameterType="Integer" resultMap="apply_result_map">
        SELECT
        <include refid="base_columns"/>
        FROM
        <include refid="table_name"/>
        WHERE id = #{id}
    </select>


    <select id="list" parameterType="com.manage.sys.sms.api.entity.query.QueryParam" resultMap="apply_result_map">
        SELECT
        <include refid="base_columns"/>
        FROM
        <include refid="table_name"/>
        <where>
            <if test="conditions.userId != null">
               AND user_id = #{conditions.userId}
            </if>
            <if test="conditions.stallId != null">
               AND stall_id = #{conditions.stallId}
            </if>
            <if test="conditions.status != null">
               AND status = #{conditions.status}
            </if>
        </where>
        ORDER BY create_time DESC
    </select>

</mapper>